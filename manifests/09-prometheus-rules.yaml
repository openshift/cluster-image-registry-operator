apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  labels:
    name: image-registry-operator-alerts
  name: image-registry-operator-alerts
  namespace: openshift-image-registry
spec:
  groups:
  - name: ImageRegistryOperator
    rules:
    - alert: ImageRegistryMissingStorageConfiguration
      expr: increase(image_registry_operator_status_degraded_total{reason="StorageNotConfigured"}[5m]) > 0
      for: 48h
      labels:
        severity: warning
      annotations:
        message: |
          Image Registry is missing a backend storage configuration. This alert
          will auto resolve once Image Registry is provided with a valid
          backend configuration.
    - alert: ImageRegistryDegraded
      expr: increase(image_registry_operator_status_degraded_total{reason!="StorageNotConfigured"}[5m]) > 0
      for: 5m
      labels:
        severity: critical
      annotations:
        message: |
          Image Registry could not be deployed and is in Degraded status.
    - alert: ImageRegistryStorageReconfigured
      expr: increase(image_registry_operator_storage_reconfigured_total[30m]) > 0
      labels:
        severity: info
      annotations:
        message: |
          Image Registry Storage configuration has changed in the last 30
          minutes. This change may have caused data loss.
